<!DOCTYPE html>
<html lang="en">
<head>
	<title><%- note.title %> | Kyanit</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="author" content="<%- note.author_display_name %> @<%- note.author_name %>">
	<meta name="keywords" content="<%- note.keywords.join(', ') %>">

	<!-- MATERIAL SYMBOLS -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

	<!-- MATHJAX -->
	<script src="/js/modules/mathjax-options.js"></script>
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2/es5/tex-svg.js"></script>

	<!-- PRISM.JS -->
	<style>
		@import url("https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism.min.css") (prefers-color-scheme: light);
		@import url("https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-okaidia.min.css") (prefers-color-scheme: dark);
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-core.min.js" integrity="sha512-Uw06iFFf9hwoN77+kPl/1DZL66tKsvZg6EWm7n6QxInyptVuycfrO52hATXDRozk7KWeXnrSueiglILct8IkkA==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-SkmBfuA2hqjzEVpmnMt/LINrjop3GKWqsuLSSB3e7iBmYK7JuWw4ldmmxwD9mdm2IRTTi0OxSAfEGvgEi0i2Kw==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>

	<link rel="stylesheet" href="/main.css">
	<link rel="stylesheet" href="/css/note.css">
	<link rel="stylesheet" href="/css/partials/markdown-document.css">
</head>
<body>
	<%- include('partials/header') %>
	<% const absoluteDate = new Intl.DateTimeFormat('en-us', { month: 'long', day: 'numeric', year: 'numeric' }).format; %>

	<main>
		<div class="meta-data">
			<div class="title"><%= note.title %></div>
			<div class="details">
				<div class="author-date">
					<span class="author-display">by <%= note.author_display_name %></span>
					<span class="author-username"><a class="anchor" href="/user/<%- note.author_name %>">@<%= note.author_name %></a></span>
					<span class="date">
						<span class="date-full">
							<% if(note.created_at.getTime() === note.updated_at.getTime()) { %>
								<%= new Date(note.created_at).toLocaleString() %>
							<% } else { %>
								<%= new Date(note.updated_at).toLocaleString() %>
							<% } %>
						</span>
						<span class="date-short">
							<% if(note.created_at.getTime() === note.updated_at.getTime()) { %>
								Published at <%= absoluteDate(note.created_at) %>
							<% } else { %>
								Updated at <%= absoluteDate(note.updated_at) %>
							<% } %>
						</span>
					</span>
				</div>
				<div class="statistic">
					<span class="view-count"><%= note.views %> <span class="material-symbols-outlined">visibility</span></span>
					<span class="comment-count"><%= commentCount %> <span class="material-symbols-outlined">comment</span></span>
					<% if(ratings.length >= MIN_RATING_COUNT_TO_SHOW) { %>
						<span class="rating"><%= rating %> <span class="material-symbols-outlined">star</span></span>
					<% } %>
				</div>
			</div>
			<% if(note.thumbnail_url) { %>
				<div class="thumbnail">
					<img src="<%- note.thumbnail_url %>"/>
				</div>
			<% } %>
		</div>
		<hr class="meta-content-separator">
		<div class="content markdown-document"><%- htmlContent %></div>
	</main>
</body>
<script>
	/* <% if(username !== note.author_name) { %> */
		setTimeout(async () => {
			console.log("5 sec");
			try {
				await fetch(`/api/notes/<%- note.id %>/views`, {
					method: 'POST',
					headers: { 'x-note-id': '<%- note.id %>' }
				});
			} catch (error) {
				// TODO: ui.alert({ title: 'Unexpected Error', message: 'Unexpected error when incrementing note view.' });
				console.error(error);
			}
		}, 30_000); // 30 seconds
	/* <% } %> */
</script>
</html>